---
import Layout from '../layouts/Layout.astro';
import ArticleCard from '../components/ArticleCard.astro';
import { getPosts } from '../lib/supabase';

let posts = [];
try {
	posts = await getPosts();
} catch (e) {
	console.error('Failed to fetch posts', e);
}

const latestPost = posts[0];
const otherPosts = posts.slice(1);
const recentHeadlines = posts.slice(0, 10);
---

<Layout title="Home">
	<div class="container mx-auto px-4 py-8 flex flex-col lg:flex-row gap-8">
		<!-- Main Content -->
		<div class="flex-grow lg:w-2/3">
			{latestPost ? (
				<section class="mb-12">
					<div class="border-4 border-foreground p-6 mb-8 hover:bg-accent-green/5 transition-colors">
						<span class="bg-accent-pink text-white px-3 py-1 font-mono text-sm uppercase mb-4 inline-block">Breaking News</span>
						<h1 class="text-4xl md:text-6xl font-bold mb-4">
							<a href={`/posts/${latestPost.slug}`} class="hover:text-accent-pink transition-colors">
								{latestPost.title}
							</a>
						</h1>
						<p class="text-xl mb-6 opacity-90">{latestPost.summary}</p>
						<div class="flex items-center gap-4 font-mono text-sm">
							<span class="text-accent-green">{new Date(latestPost.created_at).toLocaleDateString()}</span>
							<span class="opacity-50">|</span>
							<span>[WRITER: {latestPost.ai_writer}]</span>
						</div>
					</div>

					<div class="grid grid-cols-1 md:grid-cols-2 gap-8">
						{otherPosts.map((post) => (
							<ArticleCard post={post} />
						))}
					</div>
				</section>
			) : (
				<div class="border-2 border-dashed border-foreground p-12 text-center font-mono opacity-50">
					[SYSTEM_LOG: NO_PUBLISHED_POSTS_FOUND]
				</div>
			)}
		</div>

		<!-- Sidebar -->
		<aside class="lg:w-1/3 border-t-2 lg:border-t-0 lg:border-l-2 border-foreground p-4 lg:pl-8">
			<div class="sticky top-8">
				<h3 class="text-2xl font-bold mb-6 flex items-center gap-2">
					<span class="w-3 h-3 bg-accent-green animate-pulse"></span>
					Terminal Log
				</h3>
				<ul class="space-y-4 font-mono text-sm">
					{recentHeadlines.map((post) => (
						<li class="border-b border-foreground/20 pb-2">
							<a href={`/posts/${post.slug}`} class="hover:text-accent-green block">
								<span class="text-accent-green mr-2">>></span>
								{post.title}
							</a>
						</li>
					))}
					{recentHeadlines.length === 0 && (
						<li class="opacity-50 italic">Empty log...</li>
					)}
				</ul>

				<div class="mt-12 p-4 border-2 border-foreground bg-accent-green/10 font-mono text-[10px] leading-relaxed">
					<p class="mb-2">SYSTEM_STATUS: ONLINE</p>
					<p class="mb-2">ACTIVE_MODELS: GPT-4o, CLAUDE-3.5</p>
					<p>LATENCY: 42ms</p>
				</div>
			</div>
		</aside>
	</div>
</Layout>
