---
interface Props {
  imageUrl: string;
  alt: string;
  fallbackUrl?: string;
  metadata?: string;
  className?: string;
  fullImage?: boolean;
}

const { imageUrl, alt, fallbackUrl, metadata, className = "", fullImage = false } = Astro.props;

const defaultFallback = "https://image.pollinations.ai/prompt/static%20noise%20CRT%20screen%20glitch%20cyberpunk%20aesthetic?width=800&height=600&nologo=true";
---

<div class:list={["visual-uplink group mt-6 mb-8", className]}>
  <div class="relative">
    <!-- Label -->
    <div class="absolute -top-6 left-0 flex items-center gap-2 font-mono text-[10px] text-accent-green uppercase tracking-widest">
      <span class="animate-pulse">‚óè</span> [Visual_Uplink_Established]
    </div>

    <!-- Monitor Frame -->
    <div class:list={[
      "monitor-frame w-full",
      fullImage ? "aspect-auto" : "aspect-auto md:aspect-video"
    ]}>
      <div class="crt-flicker w-full h-full relative z-10 flex items-center justify-center bg-black">
        <img
          src={imageUrl}
          alt={alt}
          data-fallback={fallbackUrl || defaultFallback}
          onerror="if(!this.getAttribute('data-error')){this.setAttribute('data-error', '1'); this.src=this.getAttribute('data-fallback');}"
          class:list={[
            "w-full h-auto transition-all duration-700",
            fullImage ? "max-h-[500px] md:max-h-[800px] object-contain grayscale-0 contrast-100 brightness-100" : "md:h-full md:object-cover grayscale contrast-125 brightness-90 md:group-hover:grayscale-0 md:group-hover:brightness-100"
          ]}
        />
        <!-- Internal scanlines specific to this monitor -->
        <div class="absolute inset-0 bg-[linear-gradient(rgba(18,16,16,0)_50%,rgba(0,0,0,0.1)_50%)] bg-[length:100%_4px] pointer-events-none z-20"></div>
      </div>

      <!-- Power Indicator -->
      <div class="absolute bottom-2 right-4 z-30 flex items-center gap-2">
        <span class="text-[8px] font-mono text-neutral-500 uppercase tracking-tighter">Signal_Lock</span>
        <div class="w-1.5 h-1.5 rounded-full bg-accent-green animate-pulse shadow-[0_0_5px_#00ff41]"></div>
      </div>

      <!-- Reflection effect -->
      <div class="absolute inset-0 bg-gradient-to-tr from-transparent via-white/5 to-transparent pointer-events-none z-25"></div>
    </div>
  </div>

  <!-- Metadata Block -->
  {metadata && (
    <div class="mt-4 flex items-center gap-4 font-mono text-[9px] text-accent-green/60 uppercase tracking-[0.1em] border-t border-foreground/10 pt-3">
      <div class="flex items-center gap-2 border border-accent-green/30 px-2 py-0.5 bg-accent-green/5 text-accent-green">
        <span class="w-1 h-1 bg-accent-green"></span>
        <span>IMG_META</span>
      </div>
      <span class="italic font-bold">{metadata}</span>
    </div>
  )}
</div>
